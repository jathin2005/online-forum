<!DOCTYPE html>
<html>
<head>
    <title>Online Forum</title>
    <style>
        body {
            font-family: Arial;
            max-width: 600px;
            margin: auto;
            padding: 20px;
        }
        input, textarea {
            width: 100%;
            margin: 8px 0;
            padding: 8px;
        }
        button {
            padding: 10px;
            width: 100%;
            background: black;
            color: white;
            border: none;
            cursor: pointer;
        }
        .post {
            padding: 15px;
            border: 1px solid #ddd;
            margin: 10px 0;
            border-radius: 6px;
        }
        h3 {
            margin: 0;
        }
    </style>
</head>
<body>

    <h1>Online Forum</h1>

    <h2>Create / Edit Post</h2>
    <input id="title" placeholder="Post Title">
    <textarea id="content" placeholder="Post Content"></textarea>
    <button id="submitBtn" onclick="createPost()">Submit Post</button>

    <h2>All Posts</h2>
    <div id="posts"></div>

    <script>
        let editMode = false;
        let editId = null;

        // Load all posts
        function loadPosts() {
            fetch("/posts")
            .then(res => res.json())
            .then(posts => {
                let html = "";
                posts.forEach(p => {
                    html += `
                        <div class="post">
                            <h3>${p.title}</h3>
                            <p>${p.content}</p>

                            <button onclick="deletePost('${p._id}')" 
                                style="background:red;margin-top:10px">Delete</button>

                            <button onclick="openEdit('${p._id}', '${p.title.replace(/'/g, "\\'")}', '${p.content.replace(/'/g, "\\'")}')" 
                                style="background:green;margin-top:10px">Edit</button>
                        </div>
                    `;
                });
                document.getElementById("posts").innerHTML = html;
            });
        }

        // Create or update post
        function createPost() {
            const title = document.getElementById("title").value;
            const content = document.getElementById("content").value;

            if (!title || !content) {
                alert("Please fill in both title and content");
                return;
            }

            if (editMode) {
                // Update post
                fetch(`/posts/${editId}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ title, content })
                })
                .then(res => res.json())
                .then(() => {
                    resetForm();
                    loadPosts();
                });
            } else {
                // Create new post
                fetch("/posts", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ title, content })
                })
                .then(res => res.json())
                .then(() => {
                    resetForm();
                    loadPosts();
                });
            }
        }

        // Delete post
        function deletePost(id) {
            if (confirm("Are you sure you want to delete this post?")) {
                fetch(`/posts/${id}`, { method: "DELETE" })
                .then(res => res.json())
                .then(() => loadPosts());
            }
        }

        // Open edit mode
        function openEdit(id, title, content) {
            editMode = true;
            editId = id;
            document.getElementById("title").value = title;
            document.getElementById("content").value = content;
            document.getElementById("submitBtn").innerText = "Update Post";
        }

        // Reset form
        function resetForm() {
            editMode = false;
            editId = null;
            document.getElementById("title").value = "";
            document.getElementById("content").value = "";
            document.getElementById("submitBtn").innerText = "Submit Post";
        }

        loadPosts();
    </script>

</body>
</html>
